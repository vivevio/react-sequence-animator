{"version":3,"names":["SequenceAnimator","React","Component","frame","state","childrenArr","_getChildrenArray","length","_animationFrame","requestAnimationFrame","_onAnimate","timestamp","props","onSequenceEnd","onAnimationStop","loop","easing","duration","_animationStart","nextFrame","Math","floor","ease","setState","_playAnimation","componentDidMount","autoplay","start","componentWillUnmount","cancelAnimationFrame","stop","reset","render","_getFrame","children","Children","toArray"],"sources":["../../../src/SequenceAnimator/SequenceAnimator.tsx"],"sourcesContent":["import React from 'react';\nimport { ease } from '../common';\nimport {\n  SequenceAnimatorProps,\n  SequenceAnimatorState,\n  SequenceAnimatorDefaultProps,\n} from './types';\n\nexport class SequenceAnimator extends React.Component<\n  SequenceAnimatorProps,\n  SequenceAnimatorState\n> {\n  static displayName = 'SequenceAnimator';\n  static defaultProps: SequenceAnimatorDefaultProps = {\n    duration: 1000,\n    autoplay: true,\n    easing: 'linear',\n    loop: true,\n  };\n  private _animationFrame: ReturnType<typeof requestAnimationFrame>;\n  private _animationStart: number | null;\n\n  state = {\n    frame: 0,\n  };\n\n  componentDidMount() {\n    const { autoplay } = this.props;\n\n    if (autoplay) {\n      this.start();\n    }\n  }\n\n  componentWillUnmount() {\n    cancelAnimationFrame(this._animationFrame);\n  }\n\n  start() {\n    this._playAnimation();\n  }\n\n  stop() {\n    cancelAnimationFrame(this._animationFrame);\n  }\n\n  reset() {\n    this.setState({ frame: 0 });\n  }\n\n  render() {\n    const frame = this._getFrame();\n    return <div>{frame}</div>;\n  }\n\n  _getChildrenArray() {\n    const { children } = this.props;\n    return React.Children.toArray(children || []);\n  }\n\n  _getFrame = () => {\n    const { frame } = this.state;\n    const childrenArr = this._getChildrenArray();\n\n    return childrenArr.length >= frame ? childrenArr[frame] : null;\n  };\n\n  _playAnimation = () => {\n    this._animationFrame = requestAnimationFrame(this._onAnimate);\n  };\n\n  _onAnimate = (timestamp: number) => {\n    const {\n      onSequenceEnd,\n      onAnimationStop,\n      loop,\n      easing,\n      duration,\n    } = this.props;\n    const childrenArr = this._getChildrenArray();\n\n    if (!this._animationStart) {\n      this._animationStart = timestamp;\n    }\n\n    let nextFrame = Math.floor(\n      ease(easing)(\n        timestamp - this._animationStart,\n        0,\n        childrenArr.length,\n        duration,\n      ),\n    );\n\n    if (nextFrame > childrenArr.length - 1) {\n      if (onSequenceEnd) {\n        onSequenceEnd();\n      }\n\n      if (loop) {\n        nextFrame %= childrenArr.length;\n        this._animationStart = timestamp;\n      } else {\n        nextFrame = -1;\n      }\n    }\n\n    if (nextFrame > -1) {\n      this.setState({ frame: nextFrame }, () => {\n        this._playAnimation();\n      });\n    } else if (onAnimationStop) {\n      onAnimationStop();\n    }\n  };\n}\n"],"mappings":"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"}