{"version":3,"names":["DEFAULT_POSITION","top","left","width","height","SpriteAnimator","React","Component","frame","_animationFrame","requestAnimationFrame","_onAnimate","timestamp","props","numOfFrames","loop","easing","duration","onSequenceEnd","onAnimationStop","_animationStart","nextFrame","Math","floor","ease","setState","_playAnimation","componentDidMount","autoplay","start","componentDidUpdate","nextProps","componentWillUnmount","cancelAnimationFrame","stop","reset","render","state","getPosition","children","Children","only"],"sources":["../../../src/SpriteAnimator/SpriteAnimator.tsx"],"sourcesContent":["import React from 'react';\nimport { ease } from '../common';\nimport {\n  Position,\n  SpriteAnimatorDefaultProps,\n  SpriteAnimatorProps,\n  SpriteAnimatorState,\n} from './types';\n\nconst DEFAULT_POSITION: Position = {\n  top: 0,\n  left: 0,\n  width: '100%',\n  height: '100%',\n};\n\nexport class SpriteAnimator extends React.Component<\n  SpriteAnimatorProps,\n  SpriteAnimatorState\n> {\n  static displayName = 'SpriteAnimator';\n  static defaultProps: SpriteAnimatorDefaultProps = {\n    autoplay: true,\n    easing: 'linear',\n    loop: true,\n    numOfFrames: 0,\n    getPosition: () => DEFAULT_POSITION,\n  };\n  state = {\n    frame: 0,\n  };\n  private _animationFrame: ReturnType<typeof requestAnimationFrame>;\n  private _animationStart: number | null;\n\n  componentDidMount() {\n    const { autoplay } = this.props;\n\n    if (autoplay) {\n      this.start();\n    }\n  }\n\n  componentDidUpdate(nextProps: SpriteAnimatorProps) {\n    if (nextProps.numOfFrames !== this.props.numOfFrames) {\n      this.start();\n    }\n  }\n\n  componentWillUnmount() {\n    cancelAnimationFrame(this._animationFrame);\n  }\n\n  start() {\n    this._animationStart = null;\n    this._playAnimation();\n  }\n\n  stop() {\n    const { onAnimationStop } = this.props;\n    cancelAnimationFrame(this._animationFrame);\n\n    if (onAnimationStop) {\n      onAnimationStop();\n    }\n  }\n\n  reset() {\n    this.setState({ frame: 0 });\n  }\n\n  _playAnimation = () => {\n    this._animationFrame = requestAnimationFrame(this._onAnimate);\n  };\n\n  _onAnimate = (timestamp: number) => {\n    const {\n      numOfFrames,\n      loop,\n      easing,\n      duration,\n      onSequenceEnd,\n      onAnimationStop,\n    } = this.props;\n\n    if (!this._animationStart) {\n      this._animationStart = timestamp;\n    }\n\n    let nextFrame = Math.floor(\n      ease(easing)(timestamp - this._animationStart, 0, numOfFrames, duration),\n    );\n\n    if (nextFrame > numOfFrames - 1) {\n      if (onSequenceEnd) {\n        onSequenceEnd();\n      }\n\n      if (loop) {\n        nextFrame %= numOfFrames;\n        this._animationStart = timestamp;\n      } else {\n        nextFrame = -1;\n      }\n    }\n\n    if (nextFrame > -1) {\n      this.setState({ frame: nextFrame }, () => {\n        this._playAnimation();\n      });\n    } else if (onAnimationStop) {\n      onAnimationStop();\n    }\n  };\n\n  render() {\n    const { frame } = this.state;\n    const { getPosition, children } = this.props;\n    const { width, height, top, left } = getPosition(frame);\n\n    return (\n      <div className=\"wrapper\" style={{ width, height }}>\n        <div className=\"innerWrapper\" style={{ top: -top, left: -left }}>\n          {React.Children.only(children)}\n        </div>\n      </div>\n    );\n  }\n}\n"],"mappings":"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"}